$.ajaxSetup({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")}});document.addEventListener("DOMContentLoaded",function(){let c=!1,q=document.querySelectorAll(".question[data-question-id]").length,a=0,d=null;function h(){let e=a/q*100;document.querySelectorAll("[id^='progress-bar-']").forEach(t=>{t.style.width=e+"%"})}function f(){a=0,d=null,document.querySelectorAll(".question[data-question-id]").forEach(e=>{let t=!1,n=parseInt(e.getAttribute("data-question-index")),l=e.querySelector("input[name^='answers']:checked"),o=e.querySelector("input[name^='answers_future']:checked");(l||o)&&(t=!0),e.querySelector("input[type='checkbox']:checked")&&(t=!0),e.querySelector("input[type='text']:not(:placeholder-shown)")&&(t=!0),e.querySelector("input[type='date']:not(:placeholder-shown)")&&(t=!0),e.querySelector("textarea:not(:placeholder-shown)")&&(t=!0),t&&(a++,d=n)}),h(),console.log("Current Question Index: "+d)}document.querySelectorAll(".question input, .question textarea").forEach(e=>{e.addEventListener("input",f)}),document.querySelectorAll(".question input[type='radio'], .question input[type='checkbox']").forEach(e=>{e.addEventListener("change",f)}),f();function g(e){console.log(`Starting Quiz for Section ID: ${e}`);const t=document.getElementById(`section-card-${e}`),n=document.getElementById(`question-card-${e}`);t?t.style.display="none":console.error(`Section card not found for Section ID: ${e}`),n?(n.style.display="block",u(e,"next")):console.error(`Question card not found for Section ID: ${e}`)}function p(e){if(c){console.log("Transition already in progress, skipping...");return}console.log(`showNextSection called for Section ID: ${e}`),c=!0;const t=Array.from(document.querySelectorAll('.card[id^="section-card-"]'));let n=t.findIndex(l=>l.id===`section-card-${e}`);if(n===-1){console.error(`Section with ID ${e} not found!`),c=!1;return}if(console.log(`Hiding current section (ID: ${e})`),t[n].style.display="none",n+1<t.length){const l=t[n+1];console.log(`Displaying next section (ID: ${l.id})`);const o=l.id.split("-").pop();console.log(`Next Section ID: ${o}`),l.style.display="block";const s=document.getElementById(`start-quiz-btn-${o}`);s&&(s.style.display="block",s.onclick=function(){g(o)}),c=!1}else console.log("No more sections. Quiz completed!"),x(),E(),c=!1}function u(e,t){const n=document.querySelector(`#questions-container-${e}`),l=document.querySelector(`#question-card-${e}`);if(document.querySelector(`#current-question-number-${e}`),!n||!l){console.error(`Missing elements for Section ID: ${e}`);return}const o=n.querySelectorAll(".question");if(o.length===0){console.error(`No questions found for Section ID: ${e}`);return}let s;t==="last"?s=o.length-1:(s=Array.from(o).findIndex(i=>i.style.display==="block"),s===-1?s=0:t==="next"&&s<o.length-1?s++:t==="prev"&&s>0&&s--),o.forEach(i=>i.style.display="none"),s>=0&&(o[s].style.display="block"),document.querySelectorAll('.card[id^="question-card-"]').forEach(i=>{i.style.display="none"});let r=Array.from(document.querySelectorAll(".question[data-question-id]")),y=r.indexOf(o[s])+1;document.querySelectorAll("[id^='question-progress']").forEach(i=>{i.textContent=`Question ${y} out of ${r.length}`}),console.log(`Current Question Index: ${y} / ${r.length}`),l.style.display="block",S(e,s,o.length)}function S(e,t,n){const l=document.getElementById(`prev-btn${e}`),o=document.getElementById(`next-btn${e}`);l.style.display=t===0?"none":"inline-block",t===n-1?(o.textContent="Next",o.onclick=function(){m(e)}):(o.textContent="Next",o.onclick=function(){u(e,"next")}),l.textContent="Prev",l.onclick=function(){if(t===0){const s=Array.from(document.querySelectorAll('.card[id^="question-card-"]')).findIndex(r=>r.id===`question-card-${e}`)-1;if(s>=0){const r=document.querySelectorAll('.card[id^="question-card-"]')[s].id.split("-").pop();document.querySelector(`#questions-container-${r}`).querySelectorAll(".question").length-1,u(r,"last")}}else u(e,"prev")}}function m(e){console.log(`Finishing Section ID: ${e}`);const t=document.getElementById(`section-card-${e}`),n=document.getElementById(`question-card-${e}`);n.style.display="none",t.style.display="block",p(e)}function x(){const e=document.getElementById("completion-card");e&&(console.log("Displaying completion card..."),e.style.display="block")}function E(){const e=document.getElementById("questionTable");e&&(console.log("Displaying status card..."),e.style.display="block")}document.querySelectorAll('input[type="date"]').forEach(e=>{e.addEventListener("change",function(){const t=this.value;console.log(`Date selected for Question: ${this.name} - ${t}`)})}),document.querySelectorAll(".rating .star").forEach(e=>{e.addEventListener("click",function(){const t=this.closest(".rating").dataset.questionId,n=this.dataset.index;document.querySelector(`#selectedRating_${t}`).value=n,b(t,n)})});function A(e,t){document.querySelectorAll(`#rating_${e} .star`).forEach((l,o)=>{o<t?l.style.color="gold":l.style.color="#ccc"})}function w(e){const t=document.querySelectorAll(`#rating_${e} .star`),n=parseInt(document.querySelector(`#selectedRating_${e}`).value);t.forEach((l,o)=>{o<n?l.style.color="gold":l.style.color="#ccc"})}function b(e,t){document.querySelectorAll(`#rating_${e} .star`).forEach((l,o)=>{l.style.color=o<t?"gold":"#ccc"})}document.querySelectorAll(".star").forEach(e=>{const t=e.parentElement.id.split("_")[1];e.addEventListener("mouseover",function(){const n=parseInt(e.getAttribute("data-index"));A(t,n)}),e.addEventListener("mouseout",function(){w(t)})}),document.querySelectorAll("input[type='radio']").forEach(e=>{e.addEventListener("change",function(){var o;let t=this.getAttribute("data-question-id"),n=(o=this.closest("form"))==null?void 0:o.getAttribute("data-section-id");if(console.log(`Selected Question ID: ${t}, Section ID: ${n}`),!t){console.error("❌ Failed to retrieve question ID.");return}let l=document.getElementById(`question-${t}`);l?(l.style.backgroundColor="rgb(73, 138, 73)",l.style.color="white"):console.warn(`⚠️ No table cell found for question ID: ${t}`)})}),window.startQuiz=g,window.showQuestion=u,window.finishSection=m,window.showNextSection=p});
