$(function(){var l=$(".datatables-subplan"),r=$(".select2"),i=$("#offcanvasAddsubplan");if(r.length&&r.wrap('<div class="position-relative"></div>').select2({dropdownParent:r.parent()}),$.ajaxSetup({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")}}),l.length)var o=l.DataTable({processing:!0,serverSide:!0,ajax:{url:baseUrl+"subplan-list"},columns:[{data:""},{data:"id"},{data:"subgroup_id"},{data:"name"},{data:"price"},{data:"option"},{data:"user_limit"},{data:"site_limit"},{data:"company_limit"},{data:"features"},{data:"description"},{data:"action"}],columnDefs:[{className:"control",searchable:!1,orderable:!1,responsivePriority:2,targets:0,render:function(a,e,t,n){return""}},{searchable:!1,orderable:!1,targets:1,render:function(a,e,t,n){return`<span>${t.id}</span>`}},{targets:2,render:function(a,e,t,n){return`<span>${t.subgroup_id}</span>`}},{targets:3,responsivePriority:4,render:function(a,e,t,n){return`<span>${t.name}</span>`}},{targets:4,render:function(a,e,t,n){return`<span>${t.price}</span>`}},{targets:5,render:function(a,e,t,n){return`<span>${t.option}</span>`}},{targets:6,render:function(a,e,t,n){return`<span>${t.user_limit}</span>`}},{targets:7,render:function(a,e,t,n){return`<span>${t.site_limit}</span>`}},{targets:8,render:function(a,e,t,n){return`<span>${t.company_limit}</span>`}},{targets:9,render:function(a,e,t,n){return`<span>${t.features}</span>`}},{targets:10,render:function(a,e,t,n){return`<span>${t.description}</span>`}},{targets:-1,title:"Actions",searchable:!1,orderable:!1,render:function(a,e,t,n){return`<div class="d-flex align-items-center gap-50"><button class="btn btn-sm btn-icon edit-record btn-text-secondary rounded-pill waves-effect" data-id="${t.id}" data-bs-toggle="offcanvas" data-bs-target="#offcanvasAddsubplan"><i class="ri-edit-box-line ri-20px"></i></button><button class="btn btn-sm btn-icon delete-record btn-text-secondary rounded-pill waves-effect" data-id="${t.id}"><i class="ri-delete-bin-7-line ri-20px"></i></button></div>`}}],order:[[2,"desc"]],dom:'<"card-header d-flex rounded-0 flex-wrap pb-md-0 pt-0"<"me-5 ms-n2"f><"d-flex justify-content-start justify-content-md-end align-items-baseline"<"dt-action-buttons d-flex align-items-start align-items-md-center justify-content-sm-center gap-4"lB>>>t<"row mx-1"<"col-sm-12 col-md-6"i><"col-sm-12 col-md-6"p>>',lengthMenu:[10,20,50,70,100],language:{sLengthMenu:"_MENU_",search:"",searchPlaceholder:"Search",info:"Displaying _START_ to _END_ of _TOTAL_ entries",paginate:{next:'<i class="ri-arrow-right-s-line"></i>',previous:'<i class="ri-arrow-left-s-line"></i>'}},buttons:[{text:'<i class="ri-add-line ri-16px me-0 me-sm-2 align-baseline"></i><span class="d-none d-sm-inline-block">Add SubPlan</span>',className:"add-new btn btn-primary waves-effect waves-light",attr:{"data-bs-toggle":"offcanvas","data-bs-target":"#offcanvasAddsubplan"}}],responsive:{details:{display:$.fn.dataTable.Responsive.display.modal({header:function(a){var e=a.data();return"Details of "+e.name}}),type:"column",renderer:function(a,e,t){var n=$.map(t,function(s,u){return s.title!==""?'<tr data-dt-row="'+s.rowIndex+'" data-dt-column="'+s.columnIndex+'"><td>'+s.title+":</td> <td>"+s.data+"</td></tr>":""}).join("");return n?$('<table class="table"/><tbody />').append(n):!1}}}});$(document).on("click",".delete-record",function(){var a=$(this).data("id");Swal.fire({title:"Are you sure?",text:"You won't be able to revert this!",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, delete it!",customClass:{confirmButton:"btn btn-primary me-3",cancelButton:"btn btn-label-secondary"},buttonsStyling:!1}).then(function(e){e.value?($.ajax({type:"DELETE",url:`${baseUrl}subplan-list/${a}`,success:function(){o.draw()},error:function(t){console.log(t)}}),Swal.fire({icon:"success",title:"Deleted!",text:"The subplan has been deleted!",customClass:{confirmButton:"btn btn-success"}})):e.dismiss===Swal.DismissReason.cancel&&Swal.fire({title:"Cancelled",text:"The subplan is not deleted!",icon:"error",customClass:{confirmButton:"btn btn-success"}})})}),$(document).on("click",".edit-record",function(){var a=$(this).data("id");$("#offcanvasAddsubplanLabel").html("Edit SubPlan"),$.get(`${baseUrl}subplan-list/${a}/edit`,function(e){$("#id").val(e.id),$("#subgroup_id").val(e.subgroup_id),$("#name").val(e.name),$("#price").val(e.price),e.option==="monthly"?($("#monthly").attr("checked",!0),$("#yearly").attr("checked",!1)):e.option==="yearly"&&($("#yearly").attr("checked",!0),$("#monthly").attr("checked",!1)),$("#user_limit").val(e.user_limit),$("#site_limit").val(e.site_limit),$("#company_limit").val(e.company_limit),$("#features").val(e.features),$("#description").val(e.description)})}),$(".add-new").on("click",function(){$("#subplan").val(""),$("#offcanvasAddsubplanLabel").html("Add Subplan")});const d=document.getElementById("addNewsubplanForm"),c=FormValidation.formValidation(d,{fields:{name:{validators:{notEmpty:{message:"Please enter name"}}},price:{validators:{notEmpty:{message:"Please enter price"}}},plan_duration:{validators:{notEmpty:{message:"Please select plan"}}},features:{validators:{notEmpty:{message:"Please enter features"}}},description:{validators:{notEmpty:{message:"Please enter description"}}}},plugins:{trigger:new FormValidation.plugins.Trigger,bootstrap5:new FormValidation.plugins.Bootstrap5({eleValidClass:"",rowSelector:function(a,e){return".mb-5"}}),submitButton:new FormValidation.plugins.SubmitButton,autoFocus:new FormValidation.plugins.AutoFocus}}).on("core.form.valid",function(){$.ajax({data:$("#addNewsubplanForm").serialize(),url:`${baseUrl}subplan-list`,type:"POST",success:function(a){o.draw(),i.offcanvas("hide"),Swal.fire({icon:"success",title:"Successfully",text:"Subplan Added Successfully.",customClass:{confirmButton:"btn btn-success"}})},error:function(a){i.offcanvas("hide"),Swal.fire({title:"Error!",text:"There was an issue with your request.",icon:"error",customClass:{confirmButton:"btn btn-success"}})}})});i.on("hidden.bs.offcanvas",function(){c.resetForm(!0)})});
