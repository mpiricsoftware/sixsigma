$.ajaxSetup({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")}});document.addEventListener("DOMContentLoaded",function(){let d=!1,E=document.querySelectorAll(".question[data-question-id]").length,f=0,y=null;function x(){let e=f/E*100;document.querySelectorAll("[id^='progress-bar-']").forEach(t=>{t.style.width=e+"%"})}function p(){f=0,y=null,document.querySelectorAll(".question[data-question-id]").forEach(e=>{let t=!1,n=parseInt(e.getAttribute("data-question-index")),o=e.querySelector("input[name^='answers']:checked"),r=e.querySelector("input[name^='ans_future']:checked");(o||r)&&(t=!0),e.querySelector("input[type='checkbox']:checked")&&(t=!0),e.querySelector("input[type='text']:not(:placeholder-shown)")&&(t=!0),e.querySelector("input[type='date']:not(:placeholder-shown)")&&(t=!0),e.querySelector("textarea:not(:placeholder-shown)")&&(t=!0),t&&(f++,y=n)}),x(),console.log("Current Question Index: "+y)}document.querySelectorAll(".question input, .question textarea").forEach(e=>{e.addEventListener("input",p)}),document.querySelectorAll(".question input[type='radio'], .question input[type='checkbox']").forEach(e=>{e.addEventListener("change",p)}),p();function m(e){console.log(`Starting Quiz for Section ID: ${e}`);const t=document.getElementById(`section-card-${e}`),n=document.getElementById(`question-card-${e}`);t?t.style.display="none":console.error(`Section card not found for Section ID: ${e}`),n?(n.style.display="block",a(e,"next")):console.error(`Question card not found for Section ID: ${e}`)}function q(e){if(d){console.log("Transition already in progress, skipping...");return}console.log(`showNextSection called for Section ID: ${e}`),d=!0;const t=Array.from(document.querySelectorAll('.card[id^="section-card-"]'));let n=t.findIndex(o=>o.id===`section-card-${e}`);if(n===-1){console.error(`Section with ID ${e} not found!`),d=!1;return}if(console.log(`Hiding current section (ID: ${e})`),t[n].style.display="none",n+1<t.length){const o=t[n+1];console.log(`Displaying next section (ID: ${o.id})`);const r=o.id.split("-").pop();console.log(`Next Section ID: ${r}`),o.style.display="block";const l=document.getElementById(`start-quiz-btn-${r}`);l&&(l.style.display="block",l.onclick=function(){m(r)}),d=!1}else console.log("No more sections. Quiz completed!"),C(),k(),d=!1}function a(e,t){const n=document.querySelector(`#questions-container-${e}`),o=document.querySelector(`#question-card-${e}`);document.querySelector(`#current-question-number-${e}`);const r=document.getElementById("completion-card");if(!n||!o){console.error(`Missing elements for Section ID: ${e}`);return}const l=n.querySelectorAll(".question");if(l.length===0){console.error(`No questions found for Section ID: ${e}`);return}let s;if(t==="last")s=l.length-1;else if(s=Array.from(l).findIndex(u=>u.style.display==="block"),s===-1)s=0;else if(t==="next"&&s<l.length-1){if(!h(e,s))return;s++}else t==="prev"&&s>0&&s--;r&&(r.style.display="none"),l.forEach(u=>u.style.display="none"),s>=0&&(l[s].style.display="block"),document.querySelectorAll('.card[id^="question-card-"]').forEach(u=>{u.style.display="none"});let c=Array.from(document.querySelectorAll(".question[data-question-id]")),i=c.indexOf(l[s])+1;document.querySelectorAll("[id^='question-progress']").forEach(u=>{u.textContent=`Question ${i} out of ${c.length}`}),console.log(`Current Question Index: ${i} / ${c.length}`),o.style.display="block",g(e,s,l.length)}function A(e){console.log("Returning to last question of section:",e);let t=document.getElementById("completion-card");t&&(t.style.display="none");let n=document.querySelector(`#questions-container-${e}`);if(!n){console.error("Questions container not found!");return}let o=n.querySelectorAll(".question");if(o.length===0){console.error("No questions found in the section!");return}let r=o.length-1;o.forEach(c=>c.style.display="none");let l=o[r];l&&(l.style.display="block");let s=document.querySelector(`#question-card-${e}`);s&&(s.style.display="block"),g(e,r,o.length)}function g(e,t,n){const o=document.getElementById(`prev-btn${e}`),r=document.getElementById(`next-btn${e}`);o.style.display=t===0?"none":"inline-block",t===n-1?(r.textContent="Next",r.onclick=function(){h(e,t)&&(t===n-1?S(e):a(e,"next"))}):(r.textContent="Next",r.onclick=function(){a(e,"next")}),o.textContent="Prev",o.onclick=function(){if(t===0){const l=Array.from(document.querySelectorAll('.card[id^="question-card-"]')).findIndex(s=>s.id===`question-card-${e}`)-1;if(l>=0){const s=document.querySelectorAll('.card[id^="question-card-"]')[l].id.split("-").pop();document.querySelector(`#questions-container-${s}`).querySelectorAll(".question").length-1,a(s,"last")}}else a(e,"prev")}}function h(e,t){const o=document.querySelector(`#questions-container-${e}`).querySelectorAll(".question")[t],r=Array.from(o.querySelectorAll('input[type="radio"][name^="answers"]')),l=Array.from(o.querySelectorAll('input[type="radio"][name^="ans_future"]'));let s=r.some(i=>i.checked),c=l.some(i=>i.checked);return r.forEach(i=>{i.parentElement.classList.remove("radio-error")}),s?!s&&c?(l.forEach(i=>{i.parentElement.classList.add("radio-error")}),!1):!0:(r.forEach(i=>{i.parentElement.classList.add("radio-error")}),!1)}document.querySelectorAll('input[type="radio"]').forEach(e=>{e.addEventListener("change",t=>{t.target.parentElement.classList.remove("radio-error")})});function S(e){console.log(`Finishing Section ID: ${e}`);const t=document.getElementById(`section-card-${e}`),n=document.getElementById(`question-card-${e}`);n.style.display="none",t.style.display="block",q(e)}function C(){const e=document.getElementById("completion-card");e&&(console.log("Displaying completion card..."),e.style.display="block")}function k(){const e=document.getElementById("questionTable");e&&(console.log("Displaying status card..."),e.style.display="block")}document.querySelectorAll('input[type="date"]').forEach(e=>{e.addEventListener("change",function(){const t=this.value;console.log(`Date selected for Question: ${this.name} - ${t}`)})}),document.querySelectorAll(".rating .star").forEach(e=>{e.addEventListener("click",function(){const t=this.closest(".rating").dataset.questionId,n=this.dataset.index;document.querySelector(`#selectedRating_${t}`).value=n,v(t,n)})});function w(e,t){document.querySelectorAll(`#rating_${e} .star`).forEach((o,r)=>{r<t?o.style.color="gold":o.style.color="#ccc"})}function b(e){const t=document.querySelectorAll(`#rating_${e} .star`),n=parseInt(document.querySelector(`#selectedRating_${e}`).value);t.forEach((o,r)=>{r<n?o.style.color="gold":o.style.color="#ccc"})}function v(e,t){document.querySelectorAll(`#rating_${e} .star`).forEach((o,r)=>{o.style.color=r<t?"gold":"#ccc"})}document.querySelectorAll(".star").forEach(e=>{const t=e.parentElement.id.split("_")[1];e.addEventListener("mouseover",function(){const n=parseInt(e.getAttribute("data-index"));w(t,n)}),e.addEventListener("mouseout",function(){b(t)})}),document.querySelectorAll("input[type='radio']").forEach(e=>{e.addEventListener("change",function(){var r;let t=this.getAttribute("data-question-id"),n=(r=this.closest("form"))==null?void 0:r.getAttribute("data-section-id");if(console.log(`Selected Question ID: ${t}, Section ID: ${n}`),!t){console.error("❌ Failed to retrieve question ID.");return}let o=document.getElementById(`question-${t}`);o?(o.style.backgroundColor="rgb(73, 138, 73)",o.style.color="white"):console.warn(`⚠️ No table cell found for question ID: ${t}`)})}),window.startQuiz=m,window.showQuestion=a,Window.showLastQuestion=A,window.finishSection=S,window.showNextSection=q});
