$(function(){var s=$(".datatables-form"),i=$(".select2"),r=$("#addformModal");if($("#editformModal"),i.length&&i.each(function(){var t=$(this);select2Focus(t),t.wrap('<div class="position-relative"></div>').select2({placeholder:"Select value",dropdownParent:t.parent()})}),$.ajaxSetup({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")}}),s.length)var l=s.DataTable({processing:!0,serverSide:!0,ajax:{url:baseUrl+"form-list"},columns:[{data:""},{data:"id"},{data:"name"},{data:"action"}],columnDefs:[{className:"control",searchable:!1,orderable:!1,responsivePriority:2,targets:0,render:function(t,a,e,o){return""}},{searchable:!1,orderable:!1,targets:1,render:function(t,a,e,o){return`<span>${e.fack_id}</span>`}},{targets:2,render:function(t,a,e,o){return`<span>${e.name}</span>`}},{targets:-1,searchable:!1,title:"Actions",orderable:!1,render:function(t,a,e,o){let n=showUrl.replace(":id",e.id);return editUrl.replace(":id",e.id),`<div class="d-flex align-items-center"><span class="text-nowrap">
                <button data-id="${e.id}" class="btn btn-sm btn-icon btn-text-secondary edit-record text-body rounded-pill waves-effect waves-light" data-bs-toggle="modal" data-bs-target="#editformModal">
                    <i class="ri-edit-box-line ri-20px"></i>
                </button>
            </span><a href="${n}" class="btn btn-sm btn-icon btn-text-secondary rounded-pill waves-effect" title="Preview"><i class="ri-eye-line ri-20px"></i></a><button data-id="${e.id}" class="btn btn-sm btn-icon btn-text-secondary rounded-pill delete-record text-body waves-effect waves-light me-1"><i class="ri-delete-bin-7-line ri-20px"></i></button></div>`}}],order:[[2,"desc"]],dom:'<"row mx-1"<"col-sm-12 col-md-3 mt-5 mt-md-0" l><"col-sm-12 col-md-9"<"dt-action-buttons text-xl-end text-lg-start text-md-end text-start d-flex align-items-center justify-content-md-end justify-content-center flex-wrap me-1"<"me-4"f>B>>>t<"row mx-2"<"col-sm-12 col-md-6"i><"col-sm-12 col-md-6"p>>',language:{sLengthMenu:"Show _MENU_",search:"",searchPlaceholder:"Search form",paginate:{next:'<i class="ri-arrow-right-s-line"></i>',previous:'<i class="ri-arrow-left-s-line"></i>'}},buttons:[{text:'<i class="ri-add-line me-0 me-sm-1"></i><span class="d-none d-sm-inline-block">Add form</span>',className:"add-new btn btn-primary mb-5 mb-md-0 waves-effect waves-light",attr:{"data-bs-toggle":"modal","data-bs-target":"#addformModal"},init:function(t,a,e){$(a).removeClass("btn-secondary")}}],responsive:{details:{display:$.fn.dataTable.Responsive.display.modal({header:function(t){var a=t.data();return"Details of "+a.form_name}}),type:"column",renderer:function(t,a,e){var o=$.map(e,function(n,u){return n.title!==""?'<tr data-dt-row="'+n.rowIndex+'" data-dt-column="'+n.columnIndex+'"><td>'+n.title+":</td> <td>"+n.data+"</td></tr>":""}).join("");return o?$('<table class="table"/><tbody />').append(o):!1}}}});$(document).on("click",".delete-record",function(){var t=$(this).data("id"),a=$(".dtr-bs-modal.show");a.length&&a.modal("hide"),Swal.fire({title:"Are you sure?",text:"You won't be able to revert this!",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, delete it!",customClass:{confirmButton:"btn btn-primary me-3",cancelButton:"btn btn-label-secondary"},buttonsStyling:!1}).then(function(e){e.value?($.ajax({type:"DELETE",url:`${baseUrl}form-list/${t}`,success:function(){l.draw()},error:function(o){console.log(o)}}),Swal.fire({icon:"success",title:"Deleted!",text:"The form has been deleted!",customClass:{confirmButton:"btn btn-success"}})):e.dismiss===Swal.DismissReason.cancel&&Swal.fire({title:"Cancelled",text:"The form is not deleted!",icon:"error",customClass:{confirmButton:"btn btn-success"}})})});const d=document.getElementById("addformForm"),c=FormValidation.formValidation(d,{fields:{form_name:{validators:{notEmpty:{message:"Please enter name"}}},comp_id:{validators:{notEmpty:{message:"Please select form"}}}},plugins:{trigger:new FormValidation.plugins.Trigger,bootstrap5:new FormValidation.plugins.Bootstrap5({eleValidClass:"",rowSelector:function(t,a){return".form-floating"}}),submitButton:new FormValidation.plugins.SubmitButton,autoFocus:new FormValidation.plugins.AutoFocus}}).on("core.form.valid",function(){const t=new FormData(d);$.ajax({url:`${baseUrl}form-list`,type:"POST",data:t,processData:!1,contentType:!1,success:function(a){l.draw(),r.modal("hide"),Swal.fire({icon:"success",title:"Successfully Added!",text:"form Added Successfully.",customClass:{confirmButton:"btn btn-success"}})},error:function(a){r.modal("hide"),Swal.fire({title:"Oops!",text:"Something went wrong.",icon:"error",customClass:{confirmButton:"btn btn-success"}})}})});r.on("hidden.bs.modal",function(){c.resetForm(!0)}),$(document).on("click",".edit-record",function(){let t=$(this).data("id"),a=editUrl.replace(":id",t);console.log("Fetching data from:",a),$.get(a,function(e){$("#edit_form_id").val(e.id),$("#edit_name").val(e.name),$("#edit_slug").val(e.slug),$("#edit_description").val(e.description),$("#edit_file").val(""),$("#editformModal").modal("show")}).fail(function(e){console.error("Error fetching form data:",e.responseText),alert("Failed to load form details.")})});const m=FormValidation.formValidation(document.getElementById("editformForm"),{fields:{name:{validators:{notEmpty:{message:"Please enter form name"}}}},plugins:{trigger:new FormValidation.plugins.Trigger,bootstrap5:new FormValidation.plugins.Bootstrap5({eleValidClass:"",rowSelector:".form-floating"}),submitButton:new FormValidation.plugins.SubmitButton,autoFocus:new FormValidation.plugins.AutoFocus}}).on("core.form.valid",function(){let t=new FormData($("#editformForm")[0]),a=$("#edit_form_id").val(),e=updatenewUrl.replace(":id",a);console.log("Updating via:",e),$.ajax({url:e,type:"POST",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},data:t,contentType:!1,processData:!1,success:function(o){console.log("Success:",o),Swal.fire({icon:"success",title:"Successfully Updated!",text:o.message,customClass:{confirmButton:"btn btn-success"}}),$("#editformModal").modal("hide"),l.draw()},error:function(o){console.error("Error:",o.responseText),Swal.fire({icon:"error",title:"Update Failed!",text:"There was an issue updating the form.",customClass:{confirmButton:"btn btn-danger"}})}})});$("#editformModal").on("hide.bs.modal",function(){m.resetForm(!0)})});$("#addSection").on("click",function(){let s={section_name:$("#section_name").val(),section_description:$("#section_description").val(),questions:[]};$(".question-container").each(function(){s.questions.push({question_text:$(this).find(".question_text").val(),question_description:$(this).find(".question_description").val(),type:$(this).find(".question_type").val(),options:$(this).find(".question_options").val()})}),$.ajax({type:"POST",url:"/section-list/store",success:function(i){alert("Section added successfully!")}})});
