$.ajaxSetup({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")}});document.addEventListener("DOMContentLoaded",function(){let u=!1,S=document.querySelectorAll(".question[data-question-id]").length,d=0,y=null;function x(){let e=d/S*100;document.querySelectorAll("[id^='progress-bar-']").forEach(t=>{t.style.width=e+"%"})}function f(){d=0,y=null,document.querySelectorAll(".question[data-question-id]").forEach(e=>{let t=!1,n=parseInt(e.getAttribute("data-question-index")),o=e.querySelector("input[name^='answers']:checked"),l=e.querySelector("input[name^='answers_future']:checked");(o||l)&&(t=!0),e.querySelector("input[type='checkbox']:checked")&&(t=!0),e.querySelector("input[type='text']:not(:placeholder-shown)")&&(t=!0),e.querySelector("input[type='date']:not(:placeholder-shown)")&&(t=!0),e.querySelector("textarea:not(:placeholder-shown)")&&(t=!0),t&&(d++,y=n)}),x(),console.log("Current Question Index: "+y)}document.querySelectorAll(".question input, .question textarea").forEach(e=>{e.addEventListener("input",f)}),document.querySelectorAll(".question input[type='radio'], .question input[type='checkbox']").forEach(e=>{e.addEventListener("change",f)}),f();function p(e){console.log(`Starting Quiz for Section ID: ${e}`);const t=document.getElementById(`section-card-${e}`),n=document.getElementById(`question-card-${e}`);t?t.style.display="none":console.error(`Section card not found for Section ID: ${e}`),n?(n.style.display="block",a(e,"next")):console.error(`Question card not found for Section ID: ${e}`)}function q(e){if(u){console.log("Transition already in progress, skipping...");return}console.log(`showNextSection called for Section ID: ${e}`),u=!0;const t=Array.from(document.querySelectorAll('.card[id^="section-card-"]'));let n=t.findIndex(o=>o.id===`section-card-${e}`);if(n===-1){console.error(`Section with ID ${e} not found!`),u=!1;return}if(console.log(`Hiding current section (ID: ${e})`),t[n].style.display="none",n+1<t.length){const o=t[n+1];console.log(`Displaying next section (ID: ${o.id})`);const l=o.id.split("-").pop();console.log(`Next Section ID: ${l}`),o.style.display="block";const r=document.getElementById(`start-quiz-btn-${l}`);r&&(r.style.display="block",r.onclick=function(){p(l)}),u=!1}else console.log("No more sections. Quiz completed!"),A(),w(),u=!1}function a(e,t){const n=document.querySelector(`#questions-container-${e}`),o=document.querySelector(`#question-card-${e}`);document.querySelector(`#current-question-number-${e}`);let l=document.getElementById("completion-card");if(l&&(l.style.display="none"),!n||!o){console.error(`Missing elements for Section ID: ${e}`);return}const r=n.querySelectorAll(".question");if(r.length===0){console.error(`No questions found for Section ID: ${e}`);return}let s;t==="last"?s=r.length-1:(s=Array.from(r).findIndex(i=>i.style.display==="block"),s===-1?s=0:t==="next"&&s<r.length-1?s++:t==="prev"&&s>0&&s--),r.forEach(i=>i.style.display="none"),s>=0&&(r[s].style.display="block"),document.querySelectorAll('.card[id^="question-card-"]').forEach(i=>{i.style.display="none"});let c=Array.from(document.querySelectorAll(".question[data-question-id]")),g=c.indexOf(r[s])+1;document.querySelectorAll("[id^='question-progress']").forEach(i=>{i.textContent=`Question ${g} out of ${c.length}`}),console.log(`Current Question Index: ${g} / ${c.length}`),o.style.display="block",m(e,s,r.length)}function E(e){console.log("Returning to last question of section:",e);let t=document.getElementById("completion-card");t&&(t.style.display="none");let n=document.querySelector(`#questions-container-${e}`);if(!n){console.error("Questions container not found!");return}let o=n.querySelectorAll(".question");if(o.length===0){console.error("No questions found in the section!");return}let l=o.length-1;o.forEach(c=>c.style.display="none");let r=o[l];r&&(r.style.display="block");let s=document.querySelector(`#question-card-${e}`);s&&(s.style.display="block"),m(e,l,o.length)}function m(e,t,n){const o=document.getElementById(`prev-btn${e}`),l=document.getElementById(`next-btn${e}`);o.style.display=t===0?"none":"inline-block",t===n-1?(l.textContent="Next",l.onclick=function(){h(e)}):(l.textContent="Next",l.onclick=function(){a(e,"next")}),o.textContent="Prev",o.onclick=function(){if(t===0){const r=Array.from(document.querySelectorAll('.card[id^="question-card-"]')).findIndex(s=>s.id===`question-card-${e}`)-1;if(r>=0){const s=document.querySelectorAll('.card[id^="question-card-"]')[r].id.split("-").pop();document.querySelector(`#questions-container-${s}`).querySelectorAll(".question").length-1,a(s,"last")}}else a(e,"prev")}}function h(e){console.log(`Finishing Section ID: ${e}`);const t=document.getElementById(`section-card-${e}`),n=document.getElementById(`question-card-${e}`);n.style.display="none",t.style.display="block",q(e)}function A(){const e=document.getElementById("completion-card");e&&(console.log("Displaying completion card..."),e.style.display="block")}function w(){const e=document.getElementById("questionTable");e&&(console.log("Displaying status card..."),e.style.display="block")}document.querySelectorAll('input[type="date"]').forEach(e=>{e.addEventListener("change",function(){const t=this.value;console.log(`Date selected for Question: ${this.name} - ${t}`)})}),document.querySelectorAll(".rating .star").forEach(e=>{e.addEventListener("click",function(){const t=this.closest(".rating").dataset.questionId,n=this.dataset.index;document.querySelector(`#selectedRating_${t}`).value=n,Q(t,n)})});function C(e,t){document.querySelectorAll(`#rating_${e} .star`).forEach((o,l)=>{l<t?o.style.color="gold":o.style.color="#ccc"})}function b(e){const t=document.querySelectorAll(`#rating_${e} .star`),n=parseInt(document.querySelector(`#selectedRating_${e}`).value);t.forEach((o,l)=>{l<n?o.style.color="gold":o.style.color="#ccc"})}function Q(e,t){document.querySelectorAll(`#rating_${e} .star`).forEach((o,l)=>{o.style.color=l<t?"gold":"#ccc"})}document.querySelectorAll(".star").forEach(e=>{const t=e.parentElement.id.split("_")[1];e.addEventListener("mouseover",function(){const n=parseInt(e.getAttribute("data-index"));C(t,n)}),e.addEventListener("mouseout",function(){b(t)})}),document.querySelectorAll("input[type='radio']").forEach(e=>{e.addEventListener("change",function(){var l;let t=this.getAttribute("data-question-id"),n=(l=this.closest("form"))==null?void 0:l.getAttribute("data-section-id");if(console.log(`Selected Question ID: ${t}, Section ID: ${n}`),!t){console.error("❌ Failed to retrieve question ID.");return}let o=document.getElementById(`question-${t}`);o?(o.style.backgroundColor="rgb(73, 138, 73)",o.style.color="white"):console.warn(`⚠️ No table cell found for question ID: ${t}`)})}),window.startQuiz=p,window.showQuestion=a,Window.showLastQuestion=E,window.finishSection=h,window.showNextSection=q});
