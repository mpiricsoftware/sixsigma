$(function(){var m=$(".datatables-permissions"),r,i=baseUrl+"laravel/user-management",o=$("#addPermissionModal"),l=$("#editPermissionModal");$.ajaxSetup({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")}}),m.length&&(r=m.DataTable({processing:!0,serverSide:!0,ajax:baseUrl+"permission-list",columns:[{data:""},{data:"id"},{data:"name"},{data:"assigned_to"},{data:"created_date"},{data:""}],columnDefs:[{className:"control",searchable:!1,orderable:!1,responsivePriority:2,targets:0,render:function(e,a,t,n){return""}},{searchable:!1,orderable:!1,targets:1,render:function(e,a,t,n){return`<span>${t.fake_id}</span>`}},{targets:2,render:function(e,a,t,n){var s=t.name;return'<span class="text-nowrap text-heading">'+s+"</span>"}},{targets:3,orderable:!1,render:function(e,a,t,n){for(var s=t.assigned_to,d="",b={"Super Admin":'<a href="'+i+'"><span class="badge rounded-pill bg-label-primary me-4">Super Admin</span></a>',Admin:'<a href="'+i+'"><span class="badge rounded-pill bg-label-success me-4">Admin</span></a>',Company:'<a href="'+i+'"><span class="badge rounded-pill bg-label-warning me-4">Company</span></a>',User:'<a href="'+i+'"><span class="badge rounded-pill bg-label-info me-4">User</span></a>',Restricted:'<a href="'+i+'"><span class="badge rounded-pill bg-label-danger me-4">Restricted User</span></a>'},c=0;c<s.length;c++){var f=s[c];d+=b[f]}return'<span class="text-nowrap">'+d+"</span>"}},{targets:4,orderable:!1,render:function(e,a,t,n){var s=t.created_date;return'<span class="text-nowrap">'+s+"</span>"}},{targets:-1,searchable:!1,title:"Actions",orderable:!1,render:function(e,a,t,n){return`<div class="d-flex align-items-center"><button data-id="${t.id}" class="btn btn-sm btn-icon btn-text-secondary rounded-pill delete-record text-body waves-effect waves-light me-1"><i class="ri-delete-bin-7-line ri-20px"></i></button><span class="text-nowrap"><button data-id="${t.id}" class="btn btn-sm btn-icon btn-text-secondary edit-record text-body rounded-pill waves-effect waves-light" data-bs-target="#editPermissionModal" data-bs-toggle="modal" data-bs-dismiss="modal"><i class="ri-edit-box-line ri-20px"></i></button></span></div>`}}],order:[[2,"desc"]],dom:'<"row mx-1"<"col-sm-12 col-md-3 mt-5 mt-md-0" l><"col-sm-12 col-md-9"<"dt-action-buttons text-xl-end text-lg-start text-md-end text-start d-flex align-items-center justify-content-md-end justify-content-center flex-wrap me-1"<"me-4"f>B>>>t<"row mx-2"<"col-sm-12 col-md-6"i><"col-sm-12 col-md-6"p>>',language:{sLengthMenu:"Show _MENU_",search:"",searchPlaceholder:"Search Permissions",paginate:{next:'<i class="ri-arrow-right-s-line"></i>',previous:'<i class="ri-arrow-left-s-line"></i>'}},buttons:[{text:'<i class="ri-add-line me-0 me-sm-1"></i><span class="d-none d-sm-inline-block">Add Permission</span>',className:"add-new btn btn-primary mb-5 mb-md-0 waves-effect waves-light",attr:{"data-bs-toggle":"modal","data-bs-target":"#addPermissionModal"},init:function(e,a,t){$(a).removeClass("btn-secondary")}}],responsive:{details:{display:$.fn.dataTable.Responsive.display.modal({header:function(e){var a=e.data();return"Details of "+a.name}}),type:"column",renderer:function(e,a,t){var n=$.map(t,function(s,d){return s.title!==""?'<tr data-dt-row="'+s.rowIndex+'" data-dt-column="'+s.columnIndex+'"><td>'+s.title+":</td> <td>"+s.data+"</td></tr>":""}).join("");return n?$('<table class="table"/><tbody />').append(n):!1}}}})),$(document).on("click",".delete-record",function(){var e=$(this).data("id"),a=$(".dtr-bs-modal.show");a.length&&a.modal("hide"),Swal.fire({title:"Are you sure?",text:"You won't be able to revert this!",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, delete it!",customClass:{confirmButton:"btn btn-primary me-3",cancelButton:"btn btn-label-secondary"},buttonsStyling:!1}).then(function(t){t.value?($.ajax({type:"DELETE",url:`${baseUrl}permission-list/${e}`,success:function(){r.draw()},error:function(n){console.log(n)}}),Swal.fire({icon:"success",title:"Deleted!",text:"The permission has been deleted!",customClass:{confirmButton:"btn btn-success"}})):t.dismiss===Swal.DismissReason.cancel&&Swal.fire({title:"Cancelled",text:"The permission is not deleted!",icon:"error",customClass:{confirmButton:"btn btn-success"}})})});const u=FormValidation.formValidation(document.getElementById("addPermissionForm"),{fields:{modalPermissionName:{validators:{notEmpty:{message:"Please enter permission name"}}}},plugins:{trigger:new FormValidation.plugins.Trigger,bootstrap5:new FormValidation.plugins.Bootstrap5({eleValidClass:"",rowSelector:".col-12"}),submitButton:new FormValidation.plugins.SubmitButton,autoFocus:new FormValidation.plugins.AutoFocus}}).on("core.form.valid",function(){$.ajax({data:$("#addPermissionForm").serialize(),url:`${baseUrl}permission-list`,type:"POST",success:function(e){o.modal("hide"),r.draw(),Swal.fire({icon:"success",title:`Successfully ${e}!`,text:`Permission ${e} Successfully.`,customClass:{confirmButton:"btn btn-success"}})},error:function(e){o.modal("hide"),Swal.fire({title:"Duplicate Entry!",text:"Your permission should be unique.",icon:"error",customClass:{confirmButton:"btn btn-success"}})}})});o.on("hide.bs.modal",function(){u.resetForm(!0)}),$(document).on("click",".edit-record",function(){var e=$(this).data("id"),a=$(".dtr-bs-modal.show");a.length&&a.modal("hide"),$.get(`${baseUrl}permission-list/${e}/edit`,function(t){$("#permissionID").val(t.id),$("#editPermissionName").val(t.name)})});const p=FormValidation.formValidation(document.getElementById("editPermissionForm"),{fields:{modalPermissionName:{validators:{notEmpty:{message:"Please enter permission name"}}}},plugins:{trigger:new FormValidation.plugins.Trigger,bootstrap5:new FormValidation.plugins.Bootstrap5({eleValidClass:"",rowSelector:".col-sm-9"}),submitButton:new FormValidation.plugins.SubmitButton,autoFocus:new FormValidation.plugins.AutoFocus}}).on("core.form.valid",function(){$.ajax({data:$("#editPermissionForm").serialize(),url:`${baseUrl}permission-list`,type:"POST",success:function(e){r.draw(),l.modal("hide"),Swal.fire({icon:"success",title:`Successfully ${e}!`,text:`Permission ${e} Successfully.`,customClass:{confirmButton:"btn btn-success"}})},error:function(e){l.modal("hide"),Swal.fire({title:"Duplicate Entry!",text:"Your permission should be unique.",icon:"error",customClass:{confirmButton:"btn btn-success"}})}})});l.on("hide.bs.modal",function(){p.resetForm(!0)})});
