document.addEventListener("DOMContentLoaded",function(){(function(){$.ajaxSetup({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")}});const n=$("#addRoleModal"),o=$("#editRoleModal"),a=FormValidation.formValidation(document.getElementById("addRoleForm"),{fields:{modalRoleName:{validators:{notEmpty:{message:"Please enter role name"}}}},plugins:{trigger:new FormValidation.plugins.Trigger,bootstrap5:new FormValidation.plugins.Bootstrap5({eleValidClass:"",rowSelector:".col-12"}),submitButton:new FormValidation.plugins.SubmitButton,autoFocus:new FormValidation.plugins.AutoFocus}}).on("core.form.valid",function(){$.ajax({data:$("#addRoleForm").serialize(),url:`${baseUrl}role-list`,type:"POST",success:function(e){n.modal("hide"),Swal.fire({icon:"success",title:`Successfully ${e}!`,text:`Role ${e} successfully.`,customClass:{confirmButton:"btn btn-success"}})},error:function(e){n.modal("hide"),Swal.fire({title:"Duplicate Entry!",text:"The role name should be unique.",icon:"error",customClass:{confirmButton:"btn btn-danger"}})}})}),i=FormValidation.formValidation(document.getElementById("editRoleForm"),{fields:{roleName:{validators:{notEmpty:{message:"Please enter role name"},remote:{url:`${baseUrl}roles/check-unique`,message:"Role name already exists",async:!0}}}},plugins:{trigger:new FormValidation.plugins.Trigger,bootstrap5:new FormValidation.plugins.Bootstrap5({eleValidClass:"",rowSelector:".mb-3"}),submitButton:new FormValidation.plugins.SubmitButton,autoFocus:new FormValidation.plugins.AutoFocus}}).on("core.form.valid",function(){$.ajax({data:$("#editRoleForm").serialize(),url:$("#editRoleForm").attr("action"),type:"PUT",beforeSend:function(){o.find(".modal-body").append('<div class="loading-indicator">Loading...</div>')},success:function(){o.find(".loading-indicator").remove(),Swal.fire({icon:"success",title:"Role updated successfully!",text:"The role has been updated.",customClass:{confirmButton:"btn btn-success"}})},error:function(e){o.find(".loading-indicator").remove(),Swal.fire({title:"Update Failed!",text:"There was an error updating the role.",icon:"error",customClass:{confirmButton:"btn btn-danger"}})}})});function l(e){$.ajax({url:`${baseUrl}roles/${e}/edit`,type:"GET",beforeSend:function(){o.find(".modal-body").append('<div class="loading-indicator">Loading...</div>')},success:function(t){$("#roleName").val(t.name),$("#roleId").val(t.id),$("#editRoleForm").attr("action",`${baseUrl}roles/${t.id}`),o.modal("show")},error:function(t){Swal.fire({title:"Error!",text:"Failed to fetch role data.",icon:"error",customClass:{confirmButton:"btn btn-danger"}})},complete:function(){o.find(".loading-indicator").remove()}})}$(document).on("click",".role-edit-modal",function(){const e=$(this).data("role-id");l(e)}),n.on("hide.bs.modal",function(){a.resetForm(!0)}),o.on("hide.bs.modal",function(){i.resetForm(!0)});const r=document.querySelector("#selectAll"),d=document.querySelectorAll('[type="checkbox"]');r.addEventListener("change",e=>{d.forEach(t=>{t.checked=e.target.checked})})})()});
